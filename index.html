<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web Finansial â€” Cristian & Maharani</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #1e1e2f;
  --card-bg: #2a2a3d;
  --text-color: #e0e0e0;
  --accent: #4cafef;
  --danger: #ff4c4c;
  --success: #4caf50;
  --input-bg: #3a3a4f;
  --input-border: #555;
}
* { box-sizing:border-box; font-family:'Poppins',sans-serif; }
body { margin:0; background:var(--bg); color:var(--text-color); }
header { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:var(--card-bg);}
header h1 { margin:0; font-size:1.5rem; }
header .icon { cursor:pointer; font-size:1.2rem; }
nav { display:flex; justify-content:space-around; background:var(--card-bg); border-bottom:1px solid #444; }
nav button { flex:1; padding:1rem; background:none; border:none; color:var(--text-color); cursor:pointer; font-weight:600; }
nav button.active { background:var(--accent); color:#fff; }
.container { padding:1rem; }
.summary { display:flex; flex-wrap:wrap; gap:1rem; margin-bottom:1rem; }
.card { flex:1 1 150px; background:var(--card-bg); padding:1rem; border-radius:8px; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.3);}
.card h3 { margin:0.5rem 0 0.2rem 0; font-size:1rem; }
.card p { margin:0; font-size:1.2rem; font-weight:600; }
.form-section { background:var(--card-bg); padding:1rem; border-radius:8px; margin-bottom:1rem; }
.form-section label { display:block; margin-top:0.5rem; }
.form-section input, .form-section select, .form-section textarea { width:100%; padding:0.5rem; margin-top:0.2rem; border-radius:5px; border:1px solid var(--input-border); background:var(--input-bg); color:var(--text-color); }
.form-section button { margin-top:0.5rem; padding:0.5rem 1rem; background:var(--accent); border:none; color:#fff; border-radius:5px; cursor:pointer; }
.history { background:var(--card-bg); padding:1rem; border-radius:8px; max-height:300px; overflow-y:auto; }
.history-item { display:flex; flex-direction:column; justify-content:space-between; padding:0.5rem 0; border-bottom:1px solid #444; }
.history-item-main { display:flex; justify-content:space-between; align-items:center; }
.history-item button { background:var(--danger); border:none; color:#fff; border-radius:3px; padding:0 5px; cursor:pointer; margin-left:5px;}
.payment-item { display:flex; justify-content:space-between; margin-left:10px; margin-top:3px; }
.payment-item button { background:var(--danger); padding:0 5px; font-size:0.9rem; }
.payment-form { display:flex; gap:5px; margin-left:10px; margin-top:5px; }
.payment-form input, .payment-form select { flex:1; padding:0.3rem; font-size:0.9rem; }
#year-month { margin-bottom:1rem; display:flex; gap:10px; flex-wrap:wrap; }
#year-month select { padding:0.5rem; border-radius:5px; border:1px solid var(--input-border); background:var(--input-bg); color:var(--text-color); }
@media(max-width:768px){ .summary { flex-direction:column; } }
</style>
</head>
<body>

<header>
  <h1>Web Finansial</h1>
  <div class="icon" title="Riset Data" onclick="resetData()">&#128269;</div>
</header>

<div id="year-month">
  <select id="select-year"></select>
  <select id="select-month"></select>
</div>

<nav>
  <button class="nav-btn active" data-target="penghasilan">Penghasilan</button>
  <button class="nav-btn" data-target="tabungan">Tabungan</button>
  <button class="nav-btn" data-target="pengeluaran">Pengeluaran</button>
  <button class="nav-btn" data-target="hutang">Hutang Aktif</button>
</nav>

<div class="container">
  <!-- Ringkasan Cepat -->
  <div class="summary" id="summary">
    <div class="card"><h3>Pemasukan Cristian</h3><p id="sum-cristian">Rp0</p></div>
    <div class="card"><h3>Pemasukan Maharani</h3><p id="sum-maharani">Rp0</p></div>
    <div class="card"><h3>Tabungan Tetap</h3><p id="sum-tabungan-tetap">Rp0</p></div>
    <div class="card"><h3>Tabungan Bersama</h3><p id="sum-tabungan-bersama">Rp0</p></div>
    <div class="card"><h3>Pengeluaran Bersama</h3><p id="sum-pengeluaran-bersama">Rp0</p></div>
  </div>

  <!-- Section Penghasilan -->
  <div id="penghasilan" class="section">
    <div class="form-section">
      <h3>Input Penghasilan</h3>
      <label>Nama</label>
      <select id="input-penghasilan-nama"><option value="Cristian">Cristian</option><option value="Maharani">Maharani</option></select>
      <label>Nominal</label>
      <input type="text" id="input-penghasilan-nominal" placeholder="1.000.000" oninput="formatInputRibuan(this)">
      <label>Keterangan</label>
      <textarea id="input-penghasilan-ket" rows="2"></textarea>
      <button onclick="addPenghasilan()">Tambah</button>
    </div>
    <div class="history" id="history-penghasilan"></div>
  </div>

  <!-- Section Tabungan -->
  <div id="tabungan" class="section" style="display:none">
    <div class="form-section">
      <h3>Input Tabungan</h3>
      <label>Jenis Tabungan</label>
      <select id="input-tabungan-jenis" onchange="toggleTabunganNama()">
        <option value="Tetap">Tetap</option>
        <option value="Bersama">Bersama</option>
      </select>
      <div id="tabungan-nama-div">
        <label>Nama (jika Tetap)</label>
        <select id="input-tabungan-nama">
          <option value="Cristian">Cristian</option>
          <option value="Maharani">Maharani</option>
        </select>
      </div>
      <label>Nominal</label>
      <input type="text" id="input-tabungan-nominal" placeholder="1.000.000" oninput="formatInputRibuan(this)">
      <label>Keterangan</label>
      <textarea id="input-tabungan-ket" rows="2"></textarea>
      <button onclick="addTabungan()">Tambah</button>
    </div>
    <div class="history" id="history-tabungan"></div>
  </div>

  <!-- Section Pengeluaran -->
  <div id="pengeluaran" class="section" style="display:none">
    <div class="form-section">
      <h3>Input Pengeluaran</h3>
      <label>Sumber Dana</label>
      <select id="input-pengeluaran-sumber">
        <option value="Cristian">Pemasukan Cristian</option>
        <option value="Maharani">Pemasukan Maharani</option>
        <option value="Bersama">Tabungan Bersama</option>
      </select>
      <label>Nominal</label>
      <input type="text" id="input-pengeluaran-nominal" placeholder="1.000.000" oninput="formatInputRibuan(this)">
      <label>Keterangan</label>
      <textarea id="input-pengeluaran-ket" rows="2"></textarea>
      <button onclick="addPengeluaran()">Tambah</button>
    </div>
    <div class="history" id="history-pengeluaran"></div>
  </div>

  <!-- Section Hutang -->
  <div id="hutang" class="section" style="display:none">
    <div class="form-section">
      <h3>Input Hutang Aktif</h3>
      <label>Nama</label>
      <select id="input-hutang-nama">
        <option value="Cristian">Cristian</option>
        <option value="Maharani">Maharani</option>
        <option value="Bersama">Bersama</option>
      </select>
      <label>Nominal</label>
      <input type="text" id="input-hutang-nominal" placeholder="1.000.000" oninput="formatInputRibuan(this)">
      <label>Tanggal Jatuh Tempo</label>
      <input type="date" id="input-hutang-tgl">
      <label>Keterangan</label>
      <textarea id="input-hutang-ket" rows="2"></textarea>
      <button onclick="addHutang()">Tambah</button>
    </div>
    <div class="history" id="history-hutang"></div>
    <div class="history" id="history-pembayaran-hutang" style="margin-top:10px;">
      <h3 style="margin-bottom:5px;">History Pembayaran Hutang</h3>
    </div>
  </div>
</div>

<script>
// Navigation
const navBtns=document.querySelectorAll('.nav-btn');
navBtns.forEach(btn=>btn.addEventListener('click',()=>{
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(btn.dataset.target).style.display='block';
  navBtns.forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}));

// Year & Month selector
const yearSelect=document.getElementById('select-year');
const monthSelect=document.getElementById('select-month');
const currentYear=new Date().getFullYear();
for(let y=currentYear-5;y<=currentYear+5;y++) yearSelect.add(new Option(y,y));
yearSelect.value=currentYear;
for(let m=1;m<=12;m++) monthSelect.add(new Option(m,m));
monthSelect.value=new Date().getMonth()+1;
yearSelect.addEventListener('change',renderAll);
monthSelect.addEventListener('change',renderAll);

// Toggle Tabungan Nama
function toggleTabunganNama(){
  const jenis=document.getElementById('input-tabungan-jenis').value;
  const namaDiv=document.getElementById('tabungan-nama-div');
  namaDiv.style.display=jenis==='Tetap'?'block':'none';
}
toggleTabunganNama();

// Format Input Ribuan
function formatInputRibuan(el){
  let val=el.value.replace(/\D/g,'');
  el.value=val.replace(/\B(?=(\d{3})+(?!\d))/g,".");
}

// Helper Rupiah
function formatRibuan(num){ return 'Rp'+Number(num).toLocaleString('id-ID');}

// Data
let storageKey='webfinansial_data';
let data={};

// Load Data
function loadData(){
  const stored=localStorage.getItem(storageKey);
  if(stored) data=JSON.parse(stored);
  else data={};
  renderAll();
}

// Save Data
function saveData(){ localStorage.setItem(storageKey,JSON.stringify(data)); }

// Get Current Year-Month
function getCurrentYM(){
  return {year:yearSelect.value, month:monthSelect.value};
}

// ----- Add Penghasilan -----
function addPenghasilan(){
  const {year, month}=getCurrentYM();
  if(!data[year]) data[year]={};
  if(!data[year][month]) data[year][month]={penghasilan:[],tabungan:[],pengeluaran:[],hutang:[],pembayaranHutang:[]};
  const nama=document.getElementById('input-penghasilan-nama').value;
  const nominal=Number(document.getElementById('input-penghasilan-nominal').value.replace(/\./g,''));
  const ket=document.getElementById('input-penghasilan-ket').value;
  const id=Date.now();
  data[year][month].penghasilan.push({id,nama,nominal,ket});
  saveData(); renderAll();
}

// ----- Add Tabungan -----
function addTabungan(){
  const {year, month}=getCurrentYM();
  if(!data[year]) data[year]={};
  if(!data[year][month]) data[year][month]={penghasilan:[],tabungan:[],pengeluaran:[],hutang:[],pembayaranHutang:[]};
  const jenis=document.getElementById('input-tabungan-jenis').value;
  const nama=jenis==='Tetap'?document.getElementById('input-tabungan-nama').value:'Bersama';
  const nominal=Number(document.getElementById('input-tabungan-nominal').value.replace(/\./g,''));
  const ket=document.getElementById('input-tabungan-ket').value;
  const id=Date.now();
  data[year][month].tabungan.push({id,jenis,nama,nominal,ket});
  saveData(); renderAll();
}

// ----- Add Pengeluaran -----
function addPengeluaran(){
  const {year, month}=getCurrentYM();
  if(!data[year]) data[year]={};
  if(!data[year][month]) data[year][month]={penghasilan:[],tabungan:[],pengeluaran:[],hutang:[],pembayaranHutang:[]};
  const sumber=document.getElementById('input-pengeluaran-sumber').value;
  const nominal=Number(document.getElementById('input-pengeluaran-nominal').value.replace(/\./g,''));
  const ket=document.getElementById('input-pengeluaran-ket').value;
  const id=Date.now();
  data[year][month].pengeluaran.push({id,sumber,nominal,ket});
  saveData(); renderAll();
}

// ----- Add Hutang -----
function addHutang(){
  const {year, month}=getCurrentYM();
  if(!data[year]) data[year]={};
  if(!data[year][month]) data[year][month]={penghasilan:[],tabungan:[],pengeluaran:[],hutang:[],pembayaranHutang:[]};
  const nama=document.getElementById('input-hutang-nama').value;
  const nominal=Number(document.getElementById('input-hutang-nominal').value.replace(/\./g,''));
  const tgl=document.getElementById('input-hutang-tgl').value;
  const ket=document.getElementById('input-hutang-ket').value;
  const id=Date.now();
  data[year][month].hutang.push({id,nama,nominal,tgl,ket,pembayaran:[]});
  saveData(); renderAll();
}

// ----- Render All -----
function renderAll(){
  const {year, month}=getCurrentYM();
  if(!data[year]) data[year]={};
  if(!data[year][month]) data[year][month]={penghasilan:[],tabungan:[],pengeluaran:[],hutang:[],pembayaranHutang:[]};
  renderSummary();
  renderSection('penghasilan');
  renderSection('tabungan');
  renderSection('pengeluaran');
  renderHutang();
}

// ----- Render Summary -----
function renderSummary(){
  const {year, month}=getCurrentYM();
  const d=data[year][month];
  let sumCristian=0,sumMaharani=0,sumTabTetap=0,sumTabBersama=0,sumPengBersama=0;
  let totalCristian=0,totalMaharani=0;
  d.penghasilan.forEach(p=>p.nama==='Cristian'?totalCristian+=p.nominal:totalMaharani+=p.nominal);
  d.tabungan.forEach(t=>{
    if(t.jenis==='Tetap'){ t.nama==='Cristian'?totalCristian-=t.nominal:totalMaharani-=t.nominal; sumTabTetap+=t.nominal;}
    else{ totalCristian-=t.nominal/2; totalMaharani-=t.nominal/2; sumTabBersama+=t.nominal;}
  });
  d.pengeluaran.forEach(p=>{
    if(p.sumber==='Cristian') totalCristian-=p.nominal;
    else if(p.sumber==='Maharani') totalMaharani-=p.nominal;
    else if(p.sumber==='Bersama'){ sumPengBersama+=p.nominal; sumTabBersama-=p.nominal; }
  });
  d.pembayaranHutang.forEach(p=>{
    if(p.sumber==='Cristian') totalCristian-=p.nominal;
    else if(p.sumber==='Maharani') totalMaharani-=p.nominal;
    else if(p.sumber==='Bersama'){ totalCristian-=p.nominal/2; totalMaharani-=p.nominal/2; }
  });
  document.getElementById('sum-cristian').innerText=formatRibuan(totalCristian);
  document.getElementById('sum-maharani').innerText=formatRibuan(totalMaharani);
  document.getElementById('sum-tabungan-tetap').innerText=formatRibuan(sumTabTetap);
  document.getElementById('sum-tabungan-bersama').innerText=formatRibuan(sumTabBersama);
  document.getElementById('sum-pengeluaran-bersama').innerText=formatRibuan(sumPengBersama);
}

// ----- Render Sections -----
function renderSection(section){
  const {year, month}=getCurrentYM();
  const d=data[year][month];
  let container, items=[];
  if(section==='penghasilan'){container=document.getElementById('history-penghasilan'); items=d.penghasilan;}
  if(section==='tabungan'){container=document.getElementById('history-tabungan'); items=d.tabungan;}
  if(section==='pengeluaran'){container=document.getElementById('history-pengeluaran'); items=d.pengeluaran;}
  container.innerHTML='';
  items.forEach(i=>{
    const div=document.createElement('div'); div.className='history-item';
    let text='';
    if(section==='penghasilan') text=`${i.nama}: ${formatRibuan(i.nominal)} - ${i.ket}`;
    if(section==='tabungan') text=`${i.jenis} ${i.nama}: ${formatRibuan(i.nominal)} - ${i.ket}`;
    if(section==='pengeluaran') text=`${i.sumber}: ${formatRibuan(i.nominal)} - ${i.ket}`;
    div.innerHTML=`<div class="history-item-main"><span>${text}</span> <button onclick="deleteItem('${section}',${i.id})">Hapus</button></div>`;
    container.appendChild(div);
  });
}

// ----- Hutang -----
function renderHutang(){
  const {year, month}=getCurrentYM();
  const d=data[year][month];
  const container=document.getElementById('history-hutang');
  container.innerHTML='';
  d.hutang.forEach(h=>{
    const div=document.createElement('div'); div.className='history-item';
    const main=document.createElement('div'); main.className='history-item-main';
    main.innerHTML=`<span>${h.nama}: ${formatRibuan(h.nominal)} - ${h.tgl} - ${h.ket}</span> <button onclick="deleteHutang(${h.id})">Hapus</button>`;
    const payForm=document.createElement('div'); payForm.className='payment-form';
    payForm.innerHTML=`<select id="hutang-sumber-${h.id}"><option value="Cristian">Cristian</option><option value="Maharani">Maharani</option><option value="Bersama">Bersama</option></select>
      <input type="text" id="hutang-nominal-${h.id}" placeholder="1.000.000" oninput="formatInputRibuan(this)">
      <button onclick="payHutang(${h.id})">Bayar</button>`;
    div.appendChild(main); div.appendChild(payForm); container.appendChild(div);
  });
  renderPaymentHistory();
}

// ----- Pay Hutang -----
function payHutang(id){
  const {year, month}=getCurrentYM();
  const d=data[year][month];
  const h=d.hutang.find(x=>x.id===id);
  const sumber=document.getElementById(`hutang-sumber-${id}`).value;
  const nominal=Number(document.getElementById(`hutang-nominal-${id}`).value.replace(/\./g,''));
  if(!nominal||nominal<=0) return;
  d.pembayaranHutang.push({id,hutName:h.nama,sumber,nominal,ket:h.ket,tgl:h.tgl});
  d.hutang=d.hutang.filter(x=>x.id!==id);
  saveData(); renderAll();
}

// ----- Render Payment History -----
function renderPaymentHistory(){
  const {year, month}=getCurrentYM();
  const d=data[year][month];
  const container=document.getElementById('history-pembayaran-hutang');
  container.innerHTML='<h3 style="margin-bottom:5px;">History Pembayaran Hutang</h3>';
  d.pembayaranHutang.forEach((p,index)=>{
    const div=document.createElement('div'); div.className='history-item';
    div.innerHTML=`<div class="history-item-main"><span>${p.hutName} - ${p.sumber}: ${formatRibuan(p.nominal)} - ${p.tgl}</span> <button onclick="cancelPayment(${index})">Hapus</button></div>`;
    container.appendChild(div);
  });
}

// ----- Cancel Payment -----
function cancelPayment(index){
  const {year, month}=getCurrentYM();
  const d=data[year][month];
  const p=d.pembayaranHutang[index];
  d.hutang.push({id:Date.now(),nama:p.hutName,nominal:p.nominal,tgl:p.tgl,ket:p.ket,pembayaran:[]});
  d.pembayaranHutang.splice(index,1);
  saveData(); renderAll();
}

// ----- Delete Item -----
function deleteItem(section,id){
  const {year, month}=getCurrentYM();
  if(section==='penghasilan') data[year][month].penghasilan=data[year][month].penghasilan.filter(x=>x.id!==id);
  if(section==='tabungan') data[year][month].tabungan=data[year][month].tabungan.filter(x=>x.id!==id);
  if(section==='pengeluaran') data[year][month].pengeluaran=data[year][month].pengeluaran.filter(x=>x.id!==id);
  saveData(); renderAll();
}

// ----- Delete Hutang -----
function deleteHutang(id){
  const {year, month}=getCurrentYM();
  data[year][month].hutang=data[year][month].hutang.filter(x=>x.id!==id);
  saveData(); renderAll();
}

// ----- Reset Data / Riset -----
function resetData(){
  if(confirm("Apakah Anda yakin ingin mereset semua data bulan ini?")){
    const {year, month}=getCurrentYM();
    data[year][month]={penghasilan:[],tabungan:[],pengeluaran:[],hutang:[],pembayaranHutang:[]};
    saveData(); renderAll();
  }
}

// Load on Start
loadData();
</script>

</body>
</html>
